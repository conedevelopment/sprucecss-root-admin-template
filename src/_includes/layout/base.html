<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <script src="/js/theme-detection.js"></script>
        {% include "partial/preload.html" %}
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        {% include "partial/meta.html" %}
        <link rel="stylesheet" href="/css/main.css">
        <script>
            window.products = {{ products | dump | safe }};
            window.search = {{ search | dump | safe }};
        </script>
    </head>
    <body x-data="{
            search: {
                blank: false,
                items: window.search,
                open: false,
                term: '',
                show() {
                    this.search.open = true;
                    setTimeout(() => $focus.focus($refs.searchInput), 250);
                },
                close() {
                    this.search.open = false;
                    $refs.searchOpen.focus();
                },
                filteredItems() {
                    if (this.search.term === '') {
                        return this.search.items;
                    }
                    const result = this.search.items.filter((item) => {
                        console.log(item.caption);
                        return item.caption
                            .replace(/ /g, '')
                            .toLowerCase()
                            .includes(this.search.term.replace(/ /g, '').toLowerCase());
                    });
                    this.search.blank = result.length === 0;
                    return result;
                }
            }
        }"
    >
        <a class="btn btn--primary skip-link" href="#content">Skip to content</a>

        {% block content %}{% endblock %}

        <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/focus@3.x.x/dist/cdn.min.js"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
        <script src="/js/theme-change-assets.js" defer></script>
        <script src="/js/navigation.js" defer></script>
        <script src="/js/theme-switcher.js" defer></script>
        <script src="https://cdn.jsdelivr.net/npm/apexcharts" defer></script>
        <script src="/js/charts.js" type="module" defer></script>
        <script src="/js/range-group.js" type="module" defer></script>
        <script src="/js/repeater.js" type="module" defer></script>
    </body>
</html>
